<!-- Team Tree Item - Recursive template for hierarchical team display -->
<div class="bg-white rounded-lg border border-gray-200 overflow-hidden {% if level > 0 %}ml-8 mt-2{% else %}mb-4{% endif %}">
    <!-- Team Header -->
    <div class="p-4 {% if level > 0 %}border-l-4{% endif %}" 
         style="{% if level > 0 %}border-left-color: {{ team_data.team.color|default:'#007bff' }};{% endif %}">
        <div class="flex items-center justify-between">
            <div class="flex-1">
                <div class="flex items-center">
                    <!-- Hierarchy Indicator -->
                    {% if level > 0 %}
                        <div class="flex items-center mr-2 text-gray-400">
                            {% for i in "x"|rjust:level %}
                                <i class="fas fa-chevron-right text-xs mr-1"></i>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- Team Icon -->
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3"
                         style="background-color: {{ team_data.team.color|default:'#007bff' }}15;">
                        <i class="fas fa-users" style="color: {{ team_data.team.color|default:'#007bff' }};"></i>
                    </div>
                    
                    <!-- Team Info -->
                    <div>
                        <div class="flex items-center space-x-2">
                            <h3 class="text-lg font-medium text-gray-900">
                                <a href="{% url 'cflows:team_detail' team_data.team.id %}" 
                                   class="hover:text-indigo-600">
                                    {{ team_data.team.name }}
                                </a>
                            </h3>
                            
                            <!-- Parent Team Badge -->
                            {% if team_data.team.parent_team %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
                                    <i class="fas fa-sitemap mr-1"></i>
                                    Sub-team
                                </span>
                            {% endif %}
                            
                            <!-- Status Badge -->
                            {% if not team_data.team.is_active %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    <i class="fas fa-times-circle mr-1"></i>
                                    Inactive
                                </span>
                            {% endif %}
                            
                            <!-- Sub-teams Badge -->
                            {% if team_data.sub_teams %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    <i class="fas fa-layer-group mr-1"></i>
                                    {{ team_data.sub_teams|length }} sub-team{{ team_data.sub_teams|length|pluralize }}
                                </span>
                            {% endif %}
                        </div>
                        
                        <!-- Team Description -->
                        {% if team_data.team.description %}
                            <p class="mt-1 text-sm text-gray-600">
                                {{ team_data.team.description|truncatewords:20 }}
                            </p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Team Stats -->
                <div class="mt-3 flex items-center space-x-6 text-sm text-gray-500">
                    <div class="flex items-center">
                        <i class="fas fa-user mr-1"></i>
                        {{ team_data.team.members_count }} direct member{{ team_data.team.members_count|pluralize }}
                    </div>
                    {% if team_data.team.all_members_count != team_data.team.members_count %}
                        <div class="flex items-center">
                            <i class="fas fa-users mr-1"></i>
                            {{ team_data.team.all_members_count }} total member{{ team_data.team.all_members_count|pluralize }}
                        </div>
                    {% endif %}
                    <div class="flex items-center">
                        <i class="fas fa-gauge mr-1"></i>
                        Capacity: {{ team_data.team.default_capacity }}
                    </div>
                    {% if team_data.team.manager %}
                        <div class="flex items-center">
                            <i class="fas fa-crown mr-1"></i>
                            {{ team_data.team.manager.user.get_full_name|default:team_data.team.manager.user.username }}
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Actions -->
            {% if profile.is_organization_admin or profile.has_staff_panel_access %}
                <div class="flex items-center space-x-2 ml-4">
                    <!-- Create Sub-team -->
                    <a href="{% url 'cflows:create_team' %}?parent={{ team_data.team.id }}" 
                       class="text-gray-400 hover:text-green-600" 
                       title="Create Sub-team">
                        <i class="fas fa-plus"></i>
                    </a>
                    <!-- Edit Team -->
                    <a href="{% url 'cflows:edit_team' team_data.team.id %}" 
                       class="text-gray-400 hover:text-indigo-600" 
                       title="Edit Team">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Recursive Sub-teams -->
{% for sub_team_data in team_data.sub_teams %}
    {% include 'cflows/team_tree_item.html' with team_data=sub_team_data level=level|add:1 %}
{% endfor %}
